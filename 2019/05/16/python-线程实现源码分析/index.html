<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>pythonçº¿ç¨‹å®ç°æºç åˆ†æ | SS</title><link rel="stylesheet" type="text/css" href="../../../../css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="../../../../favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="../../../../favicon.ico"><link rel="apple-touch-icon" href="../../../../apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="../../../../apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="../../../../atom.xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-134074056-1','auto');ga('send','pageview');</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><a id="logo" href="../../../../.">SS</a><p class="description">ä¸çŸ¥é“åœ¨è¯´äº›ä»€ä¹ˆ</p></div><div id="nav-menu"><a class="current" href="../../../../."><i class="fa undefined"> é¦–é¡µ</i></a><a href="../../../../archives/"><i class="fa undefined"> å½’æ¡£</i></a><a href="../../../../about/"><i class="fa undefined"> å…³äº</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-4"><div class="content_container"><div class="post"><h1 class="post-title">pythonçº¿ç¨‹å®ç°æºç åˆ†æ</h1><div class="post-meta">May 16, 2019<span> | </span><span class="category"><a href="../../../../categories/%F0%9F%90%8Dpython/">ğŸpython</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> é˜…è¯»</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 1.8k</span><span class="post-meta-item-text"> å­—</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i><span class="post-count"> 8</span><span class="post-meta-item-text"> åˆ†é’Ÿ</span></span></span></div><div class="post-content"><h2 id="å»ºç«‹å¤šçº¿ç¨‹ç¯å¢ƒ"><a href="#å»ºç«‹å¤šçº¿ç¨‹ç¯å¢ƒ" class="headerlink" title="å»ºç«‹å¤šçº¿ç¨‹ç¯å¢ƒ"></a>å»ºç«‹å¤šçº¿ç¨‹ç¯å¢ƒ</h2><p>pythonåªæœ‰åœ¨è¿è¡Œmodule threadçš„<code>start_new_thread</code>æ–¹æ³•åä¼šå¯åŠ¨å¤šçº¿ç¨‹æ¨¡å¼ï¼Œå³åˆ›å»ºGILé”ã€‚<code>start_new_thread</code>å¯¹åº”çš„å®ç°æ˜¯threadmdule.cé‡Œçš„<code>thread_PyThread_start_new_thread</code>ï¼Œè¿™ä¸ªå‡½æ•°é¦–å…ˆå®Œæˆä¸‹é¢æ“ä½œï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">boot = PyMem_NEW(<span class="keyword">struct</span> bootstate, <span class="number">1</span>);</span><br><span class="line">boot-&gt;interp = PyThreadState_GET()-&gt;interp;</span><br><span class="line">boot-&gt;func = func;</span><br><span class="line">boot-&gt;args = args;</span><br><span class="line">boot-&gt;keyw = keyw;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šçº¿ç¨‹ç¯å¢ƒ</span></span><br><span class="line">PyEval_InitThreads(); <span class="comment">/* Start the interpreter&#x27;s thread-awareness */</span></span><br><span class="line">ident = PyThread_start_new_thread(t_bootstrap, (<span class="type">void</span>*) boot);</span><br></pre></td></tr></table></figure>

<ol>
<li>åˆå§‹åŒ–bootstateç»“æ„ï¼Œè¿™ä¸ªç»“æ„ä¿å­˜çº¿ç¨‹ä¿¡æ¯</li>
<li>åˆå§‹åŒ–pythonå¤šçº¿ç¨‹ç¯å¢ƒï¼Œ<code>PyEval_InitThreads()</code></li>
<li>ä½¿ç”¨bootstateç»“æ„ä½œä¸ºå‚æ•°ï¼Œåˆ›å»ºç³»ç»ŸåŸç”Ÿçº¿ç¨‹ï¼Œ<code>PyThread_start_new_thread</code></li>
</ol>
<p>åœ¨<code>PyEval_InitThreads()</code>ä¼šæŸ¥çœ‹æ˜¯å¦å·²ç»æ–°å»ºGILï¼Œå¦‚æœæ²¡æœ‰ï¼Œä½¿ç”¨<code>PyThread_allocate_lock</code>æ–°å»ºï¼Œç„¶åä¸»çº¿ç¨‹è¯·æ±‚é”<code>PyThread_acquire_lock</code>è¿™äº›å‡½æ•°çš„å®ç°ä¸æ“ä½œç³»ç»Ÿç›¸å…³ã€‚åŒæ—¶ä¸“é—¨ä¼šæœ‰ä¸€ä¸ªmain_threadå˜é‡å­˜æ”¾ä¸»çº¿ç¨‹pidã€‚</p>
<h2 id="å­çº¿ç¨‹åˆ›å»º"><a href="#å­çº¿ç¨‹åˆ›å»º" class="headerlink" title="å­çº¿ç¨‹åˆ›å»º"></a>å­çº¿ç¨‹åˆ›å»º</h2><p>åœ¨åˆ›å»ºå¤šçº¿ç¨‹ç¯å¢ƒçš„æœ€åä¸€è¡Œè°ƒç”¨<code>PyThread_start_new_thread</code>æ¥åˆ›å»ºçº¿ç¨‹ï¼Œè¿™ä¸ªå‡½æ•°æ ¹æ®ä¸åŒç³»ç»Ÿæœ‰ç€ä¸åŒçš„å®ç°ï¼Œä¸‹é¢æ˜¯pthreadçš„å®ç°ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span></span><br><span class="line"><span class="title function_">PyThread_start_new_thread</span><span class="params">(<span class="type">void</span> (*func)(<span class="type">void</span> *), <span class="type">void</span> *arg)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">pthread_t</span> th;</span><br><span class="line">	<span class="type">int</span> status;</span><br><span class="line">	<span class="type">pthread_attr_t</span> attrs;</span><br><span class="line">	<span class="type">size_t</span>	tss;</span><br><span class="line">	<span class="keyword">if</span> (pthread_attr_init(&amp;attrs) != <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	tss = (_pythread_stacksize != <span class="number">0</span>) ? _pythread_stacksize</span><br><span class="line">					 : THREAD_STACK_SIZE;</span><br><span class="line">	<span class="keyword">if</span> (tss != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (pthread_attr_setstacksize(&amp;attrs, tss) != <span class="number">0</span>) &#123;</span><br><span class="line">			pthread_attr_destroy(&amp;attrs);</span><br><span class="line">			<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	pthread_attr_setscope(&amp;attrs, PTHREAD_SCOPE_SYSTEM);</span><br><span class="line"></span><br><span class="line">	status = pthread_create(&amp;th, </span><br><span class="line">				 &amp;attrs,</span><br><span class="line">				 (<span class="type">pthread_attr_t</span>*)<span class="literal">NULL</span>,</span><br><span class="line">				 (<span class="type">void</span>* (*)(<span class="type">void</span> *))func,</span><br><span class="line">				 (<span class="type">void</span> *)arg</span><br><span class="line">				 );</span><br><span class="line">	pthread_attr_destroy(&amp;attrs);</span><br><span class="line">	<span class="keyword">if</span> (status != <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        pthread_detach(th);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (<span class="type">long</span>) th;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…³é”®åœ¨<code>pthread_create</code>ä¸Šè°ƒç”¨ä¼ å…¥çš„funcä»¥åŠä¼ å…¥argï¼Œè¿™ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯<code>t_bootstrap</code>å’Œ<code>bootstate</code>ç»“æ„çš„bootï¼Œbooté‡Œé¢åŒ…æ‹¬è¦æ‰§è¡Œçš„pythonå‡½æ•°ã€è§£é‡Šå™¨ã€‚</p>
<h2 id="å­çº¿ç¨‹è¿è¡Œ"><a href="#å­çº¿ç¨‹è¿è¡Œ" class="headerlink" title="å­çº¿ç¨‹è¿è¡Œ"></a>å­çº¿ç¨‹è¿è¡Œ</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span></span><br><span class="line"><span class="title function_">t_bootstrap</span><span class="params">(<span class="type">void</span> *boot_raw)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">bootstate</span> *<span class="title">boot</span> =</span> (<span class="keyword">struct</span> bootstate *) boot_raw;</span><br><span class="line">	PyThreadState *tstate;</span><br><span class="line">	PyObject *res;</span><br><span class="line"></span><br><span class="line">	tstate = PyThreadState_New(boot-&gt;interp);</span><br><span class="line">	PyEval_AcquireThread(tstate);  <span class="comment">// è¯·æ±‚GILé”ï¼Œå­è¿›ç¨‹è‡ªå·±å°†è‡ªå·±æŒ‚èµ·</span></span><br><span class="line">	res = PyEval_CallObjectWithKeywords(boot-&gt;func, boot-&gt;args, boot-&gt;keyw);</span><br><span class="line">	Py_DECREF(boot-&gt;func);</span><br><span class="line">	Py_DECREF(boot-&gt;args);</span><br><span class="line">	Py_XDECREF(boot-&gt;keyw);</span><br><span class="line">	PyMem_DEL(boot_raw);</span><br><span class="line">	PyThreadState_Clear(tstate);</span><br><span class="line">	PyThreadState_DeleteCurrent();</span><br><span class="line">	PyThread_exit_thread();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨t_bootstrapä¸­åˆ†åˆ«æ‰§è¡Œï¼š</p>
<ol>
<li><p><code>PyEval_AcquireThread()</code>, è¯·æ±‚GILé”ï¼Œè¿™ä¸ªé”ç›®å‰æ˜¯åœ¨<code>main_thread</code>ä¸­ã€‚</p>
<ol>
<li>å°†current thread stateäº¤äº’ä¸ºå½“å‰å­çº¿ç¨‹çš„state</li>
</ol>
</li>
<li><p>ä½¿ç”¨<code>PyEval_VallObjectWithKeywords</code>æ¥æ‰§è¡Œpythonå‡½æ•°ã€‚</p>
<ol>
<li>è¿™ä¸ªå‡½æ•°å†…éƒ¨æ‰§è¡Œ<code>PyObject_call</code></li>
<li><code>PyObject_call</code>ä¼šè°ƒç”¨</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PyObject *</span><br><span class="line"><span class="title function_">PyObject_Call</span><span class="params">(PyObject *func, PyObject *arg, PyObject *kw)</span></span><br><span class="line">&#123;</span><br><span class="line">  ternaryfunc call;</span><br><span class="line">	call = func-&gt;ob_type-&gt;tp_call</span><br><span class="line">	PyObject *result = (*call)(func, arg, kw);</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>æ‰§è¡Œå®Œæˆåï¼Œé‡Šæ”¾GILã€‚</p>
</li>
</ol>
<h2 id="çº¿ç¨‹è¿è¡Œç¯å¢ƒ"><a href="#çº¿ç¨‹è¿è¡Œç¯å¢ƒ" class="headerlink" title="çº¿ç¨‹è¿è¡Œç¯å¢ƒ"></a>çº¿ç¨‹è¿è¡Œç¯å¢ƒ</h2><p>åœ¨<code>t_bootstrap</code>ä¸­ä¼šæ–°å»º<code>PyThreadState</code>ï¼Œè¿™ä¸ªç»“æ„ä½“ä¿å­˜frameã€interpreterã€thread_idã€next_stateç­‰ä¿¡æ¯ã€‚</p>
<p>Pythonå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªStateå¯¹è±¡é“¾è¡¨ï¼Œå½“åˆ‡æ¢å½“å‰stateæ—¶ï¼Œä¼šåˆ°è¿™ä¸ªé“¾è¡¨ä¸Šå¯»æ‰¾ã€‚æ¯ä¸ªé“¾è¡¨å…ƒç´ ä¼šä¿å­˜thread_idã€keyã€ä»¥åŠæŒ‡å‘ThreadStateçš„æŒ‡é’ˆã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">key</span> &#123;</span></span><br><span class="line">	<span class="comment">/* Next record in the list, or NULL if this is the last record. */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">key</span> *<span class="title">next</span>;</span></span><br><span class="line">	<span class="comment">/* The thread id, according to PyThread_get_thread_ident(). */</span></span><br><span class="line">	<span class="type">long</span> id;</span><br><span class="line">	<span class="comment">/* The key and its associated value. */</span></span><br><span class="line">	<span class="type">int</span> key;</span><br><span class="line">	<span class="type">void</span> *value;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>åŒæ—¶æä¾›set_key_valueã€get_key_valueã€delete_keyè¿™å‡ ä¸ªapiæ¥æ“ä½œè¿™ä¸ªé“¾è¡¨ã€‚åœ¨å­è¿›ç¨‹<code>t_bootstrap</code>åˆ›å»ºå‡½æ•°ä¸­ä½¿ç”¨<code>PyThreadState_New</code>æ¥åˆ›å»ºstateï¼ŒåŒæ—¶æ”¾å…¥keyé“¾è¡¨ä¸­ã€‚</p>
<p>å­çº¿ç¨‹åœ¨è·å–GILåï¼Œèµ¶ç´§æŠŠå½“å‰stateåˆ‡æ¢æˆè‡ªå·±çš„ã€‚ä¹‹åè¿›å…¥<code>PyEval_CallObjectWithKeywords</code>ï¼Œæœ€åè¿›å…¥è™šæ‹Ÿæœºçš„æ‰§è¡Œã€‚</p>
<h2 id="çº¿ç¨‹è°ƒåº¦"><a href="#çº¿ç¨‹è°ƒåº¦" class="headerlink" title="çº¿ç¨‹è°ƒåº¦"></a>çº¿ç¨‹è°ƒåº¦</h2><p>pythonå¤šçº¿ç¨‹ä½¿ç”¨ç³»ç»ŸåŸç”Ÿçš„çº¿ç¨‹ã€‚pythonå­—èŠ‚ç è§£é‡Šå™¨ä¼šæŒ‰ç…§æŒ‡ä»¤çš„é¡ºåºä¸€æ¡æ¡æ‰§è¡Œï¼Œpythonå†…éƒ¨ç»´æŠ¤ä¸€ä¸ªæ—¶é’Ÿå€¼ï¼Œæ¯è¿è¡Œæ—¶é’Ÿå€¼ä¸ªæŒ‡ä»¤åä¼šå¯åŠ¨çº¿ç¨‹è°ƒåº¦ï¼ˆåŒæ—¶ç”¨äºæ£€æµ‹æ˜¯å¦æœ‰å¼‚æ­¥äº‹ä»¶å‘ç”Ÿï¼‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> sys</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sys.getcheckinterval() <span class="comment"># æŸ¥çœ‹å†…éƒ¨æ—¶é’Ÿå€¼</span></span><br><span class="line"><span class="number">100</span></span><br></pre></td></tr></table></figure>


<p>åœ¨è¿›å…¥è™šæ‹Ÿæœºåï¼Œä¸»è¦é <code>PyEval_EvalFrameEx</code>æ¥æ‰§è¡Œä¿¡æ¯è°ƒåº¦ã€‚</p>
<p>åœ¨Python&#x2F;ceval.c&#x2F;PyEval_EvalFrameExå‡½æ•°ä¸­æœ‰ä¸ªå¤§å¾ªç¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(;;)&#123;</span><br><span class="line">	<span class="keyword">if</span> (--_Py_Ticker &lt; <span class="number">0</span>) &#123; <span class="comment">// æ¯_Py_CheckIntervalä¸ªæ—¶é—´ç‰‡æ®µï¼Œè¿›è¡Œä¸€äº›éœ€è¦å‘¨æœŸæ‰§è¡Œçš„äº‹æƒ…</span></span><br><span class="line">		<span class="keyword">if</span> (*next_instr == SETUP_FINALLY) &#123;</span><br><span class="line">        <span class="comment">/* Make the last opcode before</span></span><br><span class="line"><span class="comment">           a try: finally: block uninterruptable. */</span></span><br><span class="line">        <span class="keyword">goto</span> fast_next_opcode;</span><br><span class="line">    &#125;</span><br><span class="line">		_Py_Ticker = _Py_CheckInterval;</span><br><span class="line">		tstate-&gt;tick_counter++;</span><br><span class="line">    </span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> WITH_THREAD</span></span><br><span class="line">			<span class="keyword">if</span> (interpreter_lock) &#123; </span><br><span class="line">				<span class="comment">/* Give another thread a chance */</span></span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (PyThreadState_Swap(<span class="literal">NULL</span>) != tstate)  <span class="comment">// é‡Šæ”¾å½“å‰thread state</span></span><br><span class="line">					Py_FatalError(<span class="string">&quot;ceval: tstate mix-up&quot;</span>);</span><br><span class="line">				PyThread_release_lock(interpreter_lock); <span class="comment">// å½“å‰çº¿ç¨‹é‡Šæ”¾GIL</span></span><br><span class="line"></span><br><span class="line">				<span class="comment">/* Other threads may run now */</span></span><br><span class="line"></span><br><span class="line">				PyThread_acquire_lock(interpreter_lock, <span class="number">1</span>); <span class="comment">// å…¶ä»–çº¿ç¨‹æˆ–çˆ¶çº¿ç¨‹è·å–GIL</span></span><br><span class="line">				<span class="keyword">if</span> (PyThreadState_Swap(tstate) != <span class="literal">NULL</span>)</span><br><span class="line">					Py_FatalError(<span class="string">&quot;ceval: orphan tstate&quot;</span>);</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* Check for thread interrupts */</span></span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (tstate-&gt;async_exc != <span class="literal">NULL</span>) &#123;</span><br><span class="line">					x = tstate-&gt;async_exc;</span><br><span class="line">					tstate-&gt;async_exc = <span class="literal">NULL</span>;</span><br><span class="line">					PyErr_SetNone(x);</span><br><span class="line">					Py_DECREF(x);</span><br><span class="line">					why = WHY_EXCEPTION;</span><br><span class="line">					<span class="keyword">goto</span> on_error;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºä¸»çº¿ç¨‹åˆ›å»ºå­çº¿ç¨‹çš„pythonè„šæœ¬ï¼Œå®ƒä»¬çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š</p>
<ol>
<li>ä¸€å¼€å§‹åªæœ‰ä¸»çº¿ç¨‹ï¼Œå®ƒæ­£åœ¨æ‰§è¡Œ<code>PyEval_EvalFrameEx</code>ï¼Œç„¶åæ–°å»ºå­çº¿ç¨‹ï¼Œæ­¤æ—¶æ–°å»ºGILé”ï¼ŒåŒæ—¶ä¸»çº¿ç¨‹è·å–GILé”ã€‚</li>
<li>ç„¶åå­çº¿ç¨‹æ‰§è¡Œ<code>t_bootstrap</code>ï¼Œåœ¨<code>PyEval_AcquireThread()</code>ä¸­é˜»å¡ï¼Œç­‰å¾…GILé”ã€‚</li>
<li>ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼ŒåŒæ—¶_Py_Tickerä¸æ–­å‡å°‘ï¼Œç›´åˆ°å°äº0æ—¶ï¼Œä¸»çº¿ç¨‹ä¼šå°†å½“å‰thread_stateè®¾ç½®ä¸ºç©ºï¼Œç„¶åé‡Šæ”¾GILã€‚</li>
<li>ä¹‹å‰ç­‰å¾…GILçš„å­çº¿ç¨‹ä¼šè¢«æ“ä½œç³»ç»Ÿå”¤é†’ã€‚ç„¶åçˆ¶çº¿ç¨‹å†æ¬¡è¯·æ±‚GILï¼Œä¼šå¤„äºç­‰å¾…ã€‚</li>
<li>ä¹‹åå­çº¿ç¨‹çš„æ‰§è¡Œä¹Ÿä¼šå¢åŠ _PyTickerï¼Œä¹Ÿä¼šç»å†å°äº0æ—¶çš„é‡Šæ”¾è¿‡ç¨‹ã€‚</li>
</ol>
<h2 id="é˜»å¡è°ƒç”¨"><a href="#é˜»å¡è°ƒç”¨" class="headerlink" title="é˜»å¡è°ƒç”¨"></a>é˜»å¡è°ƒç”¨</h2><p>å¯¹äºæŸäº›è°ƒç”¨æ¯”å¦‚<code>time.sleep(), fp.read(), flock(fd, operation)</code>ç­‰ï¼Œéƒ½ä¼šå°†çº¿ç¨‹é˜»å¡ï¼Œæ­¤æ—¶ä¹Ÿéœ€è¦è¿›è¡Œçº¿ç¨‹è°ƒåº¦ã€‚</p>
<p>æ¯”å¦‚åœ¨flockå‡½æ•°ï¼Œå› ä¸ºflockåœ¨ä¸åŒçš„ç³»ç»Ÿé‡Œé¢å®ç°ä¸ä¸€æ ·ï¼Œä¸‹é¢æ˜¯linuxçš„ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">fcntl_flock</span><span class="params">(PyObject *self, PyObject *args)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> fd;</span><br><span class="line">	<span class="type">int</span> code;</span><br><span class="line">	<span class="type">int</span> ret;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!PyArg_ParseTuple(args, <span class="string">&quot;O&amp;i:flock&quot;</span>,</span><br><span class="line">                              conv_descriptor, &amp;fd, &amp;code))</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> HAVE_FLOCK</span></span><br><span class="line">	Py_BEGIN_ALLOW_THREADS  <span class="comment">// å…³é”®</span></span><br><span class="line">	ret = flock(fd, code);</span><br><span class="line">	Py_END_ALLOW_THREADS</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">  <span class="comment">// è¿™é‡Œæ˜¯æ²¡æœ‰flock()å‡½æ•°çš„å¹³å°ä»£ç </span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">/* HAVE_FLOCK */</span></span></span><br><span class="line">	<span class="keyword">if</span> (ret &lt; <span class="number">0</span>) &#123;</span><br><span class="line">		PyErr_SetFromErrno(PyExc_IOError);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	Py_INCREF(Py_None);</span><br><span class="line">	<span class="keyword">return</span> Py_None;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨linuxä¸­å¦‚æœè¿™ä¸ªé”è¢«å…¶ä»–çº¿ç¨‹æ‹¿åˆ°ï¼Œ<code>flock</code>ä¼šé˜»å¡çº¿ç¨‹ã€‚åœ¨<code>ret = flock(fd, code);</code>ä¸Šä¸‹åˆ†åˆ«æœ‰ä¸¤ä¸ªå®ï¼Œè¿™ä¸¤ä¸ªå®å±•å¼€æ˜¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> Py_BEGIN_ALLOW_THREADS &#123; \</span></span><br><span class="line"><span class="meta">			PyThreadState *_save; \</span></span><br><span class="line"><span class="meta">			_save = PyEval_SaveThread();</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Py_END_ALLOW_THREADS	PyEval_RestoreThread(_save); \</span></span><br><span class="line"><span class="meta">		 &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PyThreadState *</span><br><span class="line"><span class="title function_">PyEval_SaveThread</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	PyThreadState *tstate = PyThreadState_Swap(<span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span> (interpreter_lock)</span><br><span class="line">		PyThread_release_lock(interpreter_lock);</span><br><span class="line">	<span class="keyword">return</span> tstate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span></span><br><span class="line"><span class="title function_">PyEval_RestoreThread</span><span class="params">(PyThreadState *tstate)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (interpreter_lock) &#123;</span><br><span class="line">		PyThread_acquire_lock(interpreter_lock, <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	PyThreadState_Swap(tstate);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨<code>Py_BEGIN_ALLOW_THREADS</code>ä¸­ä¸»è¦é‡Šæ”¾äº†GILï¼Œè€Œ<code>Py_END_ALLOW_THREADS</code>ä¸­å­çº¿ç¨‹ç”³è¯·GIL</p>
<h2 id="çº¿ç¨‹é”€æ¯"><a href="#çº¿ç¨‹é”€æ¯" class="headerlink" title="çº¿ç¨‹é”€æ¯"></a>çº¿ç¨‹é”€æ¯</h2><p>åœ¨<code>t_bootstrap</code>ä¸­çš„<code>PyThreadState_Clear(tstate)</code>, <code>PyThreadState_DeleteCurrent()</code>, <code>PyThread_exit_thread()</code>å‡½æ•°ç”¨äºçº¿ç¨‹é”€æ¯ã€‚</p>
<ul>
<li><code>PyThreadState_Clear(tstate)</code>ï¼šè¿™ä¸ªå‡½æ•°æ¸…ç©ºPyThreadStateé‡Œé¢çš„å˜é‡ã€‚</li>
<li><code>PyThreadState_DeleteCurrent</code>ï¼šåˆ é™¤å½“å‰çº¿ç¨‹å¯¹è±¡ï¼Œç„¶åé‡Šæ”¾GILã€‚</li>
<li><code>PyThread_exit_thread()</code>ï¼šåœ¨pthreadä¸­æ˜¯ç›´æ¥exit(0)é€€å‡ºçº¿ç¨‹ã€‚</li>
</ul>
<h2 id="çº¿ç¨‹é”ä¸åŒæ­¥"><a href="#çº¿ç¨‹é”ä¸åŒæ­¥" class="headerlink" title="çº¿ç¨‹é”ä¸åŒæ­¥"></a>çº¿ç¨‹é”ä¸åŒæ­¥</h2><p>è™½ç„¶åœ¨pythonä¸­GILé”ä½äº†ç³»ç»Ÿapiæä¾›çš„èµ„æºï¼Œæ¯”å¦‚fwriteè¿™ç§ï¼Œä½†æ˜¯å¯¹äºpythonè‡ªå·±çš„å˜é‡æ¥è¯´ï¼Œéœ€è¦pythonç”¨æˆ·æ€çš„é”æ¥ä¿æŒä¸€è‡´æ€§ã€‚</p>
<h3 id="æ–°å»ºé”"><a href="#æ–°å»ºé”" class="headerlink" title="æ–°å»ºé”"></a>æ–°å»ºé”</h3><p>åœ¨pythonä¸­åˆ†é…ä¸€ä¸ªé”ä½¿ç”¨<code>thread.allocate_lock()</code>å¯¹åº”çš„c apiæ˜¯<code>thread_PyThread_allocate_lock</code>ï¼Œå†å¾€é‡Œå…·ä½“å®ç°æ˜¯<code>newlockobject()</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> lockobject *</span><br><span class="line"><span class="title function_">newlockobject</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	lockobject *self;</span><br><span class="line">	self = PyObject_New(lockobject, &amp;Locktype);	</span><br><span class="line">	self-&gt;lock_lock = PyThread_allocate_lock();</span><br><span class="line">	<span class="keyword">return</span> self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œé¢çš„<code>PyThread_allocate_lock()</code>ä¸å¹³å°ç›¸å…³ï¼Œä¸‹é¢ä½¿ç”¨pthreadæ¥å®ç°</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PyThread_type_lock </span><br><span class="line"><span class="title function_">PyThread_allocate_lock</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">sem_t</span> *lock;</span><br><span class="line">	<span class="type">int</span> status, error = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	lock = (<span class="type">sem_t</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">sem_t</span>));</span><br><span class="line">	status = sem_init(lock,<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (PyThread_type_lock)lock;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è·å–é”"><a href="#è·å–é”" class="headerlink" title="è·å–é”"></a>è·å–é”</h3><p><code>lock.acquire()</code>ç”±<code>lock_PyThread_acquire_lock</code>å®ç°</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">lock_PyThread_acquire_lock</span><span class="params">(lockobject *self, PyObject *args)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> i = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!PyArg_ParseTuple(args, <span class="string">&quot;|i:acquire&quot;</span>, &amp;i))</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	Py_BEGIN_ALLOW_THREADS</span><br><span class="line">	i = PyThread_acquire_lock(self-&gt;lock_lock, i);</span><br><span class="line">	Py_END_ALLOW_THREADS</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="title function_">PyBool_FromLong</span><span class="params">((<span class="type">long</span>)i)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºè·å–é”ä¼šè¢«é˜»å¡ï¼Œæ‰€ä»¥éœ€è¦åœ¨æ‰§è¡Œå‰é‡Šæ”¾GILï¼Œä¹‹åå†è·å–ã€‚</p>
<h3 id="é‡Šæ”¾é”"><a href="#é‡Šæ”¾é”" class="headerlink" title="é‡Šæ”¾é”"></a>é‡Šæ”¾é”</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">lock_PyThread_release_lock</span><span class="params">(lockobject *self)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* Sanity check: the lock must be locked */</span></span><br><span class="line">	<span class="keyword">if</span> (PyThread_acquire_lock(self-&gt;lock_lock, <span class="number">0</span>)) &#123;</span><br><span class="line">		PyThread_release_lock(self-&gt;lock_lock);</span><br><span class="line">		PyErr_SetString(ThreadError, <span class="string">&quot;release unlocked lock&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	PyThread_release_lock(self-&gt;lock_lock);</span><br><span class="line">	Py_INCREF(Py_None);</span><br><span class="line">	<span class="keyword">return</span> Py_None;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨é‡Šæ”¾å‰éœ€è¦ç¡®ä¿å½“å‰çº¿ç¨‹è·å–äº†é”ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘è§‰å¾—pythonçš„å¤šçº¿ç¨‹æ›´å¤šçš„è¢«GILåˆ¶çº¦ï¼Œåªæœ‰é˜»å¡çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå’Œè¯·æ±‚é”çš„æ—¶å€™GILæ‰ä¼šè¢«é‡Šæ”¾ï¼Œè¿™å¯¼è‡´åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¤„äºæ‰§è¡Œè¿™ä¼šå¯¼è‡´pythonåœ¨å¤šçº¿ç¨‹è®¡ç®—æ—¶æ²¡æœ‰æ•ˆæœã€‚</p>
</div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>æœ¬æ–‡ä½œè€…ï¼š</strong>ss</li><li class="post-copyright-link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="/2019/05/16/python-çº¿ç¨‹å®ç°æºç åˆ†æ/">https://ssdemajia.github.io/2019/05/16/python-%E7%BA%BF%E7%A8%8B%E5%AE%9E%E7%8E%B0%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</a></li><li class="post-copyright-license"><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬ç«™æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0 CN</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li></ul></div><br><div class="tags"></div><div class="post-nav"><a class="pre" href="../../18/vscode-remote%E5%88%9D%E4%BD%93%E9%AA%8C/">vscode remote sshåˆä½“éªŒ</a><a class="next" href="../../13/460-LFU-Cache/">460. LFU Cache</a></div><div id="comments"><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">é˜…è¯»è¯„è®ºï¼ˆè¯·ç¡®ä¿ Disqus å¯ä»¥æ­£å¸¸åŠ è½½ï¼‰</button></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'https://ssdemajia.github.io/2019/05/16/python-çº¿ç¨‹å®ç°æºç åˆ†æ/';
    this.page.identifier = '2019/05/16/python-çº¿ç¨‹å®ç°æºç åˆ†æ/';
    this.page.title = 'pythonçº¿ç¨‹å®ç°æºç åˆ†æ';
  };</script><script type="text/javascript" id="disqus-lazy-load-script">$.ajax({
url: 'https://disqus.com/next/config.json',
timeout: 2500,
type: 'GET',
success: function(){
  var d = document;
  var s = d.createElement('script');
  s.src = '//dowob.disqus.com/embed.js';
  s.setAttribute('data-timestamp', + new Date());
  (d.head || d.body).appendChild(s);
  $('.disqus_click_btn').css('display', 'none');
},
error: function() {
  $('.disqus_click_btn').css('display', 'block');
}
});</script><script type="text/javascript" id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//dowob.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script type="text/javascript" id="disqus-count-script">$(function() {
     var xhr = new XMLHttpRequest();
     xhr.open('GET', '//disqus.com/next/config.json', true);
     xhr.timeout = 2500;
     xhr.onreadystatechange = function () {
       if (xhr.readyState === 4 && xhr.status === 200) {
         $('.post-meta .post-comments-count').show();
         var s = document.createElement('script');
         s.id = 'dsq-count-scr';
         s.src = 'https://dowob.disqus.com/count.js';
         s.async = true;
         (document.head || document.body).appendChild(s);
       }
     };
     xhr.ontimeout = function () { xhr.abort(); };
     xhr.send(null);
   });  </script></div></div></div></div></div><div class="pure-u-1 pure-u-md-4"><div id="footer">Copyright Â© 2024 <a href="../../../../." rel="nofollow">SS.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/ssdemajia"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/ssdemajia"> SS.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="../../../../js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="../../../../js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="../../../../js/smartresize.js?v=0.0.0"></script></div></body></html>